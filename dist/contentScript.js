!function(){"use strict";let e=null;var o=function(e,o,t,n){return new(t||(t=Promise))((function(i,l){function s(e){try{d(n.next(e))}catch(e){l(e)}}function c(e){try{d(n.throw(e))}catch(e){l(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,c)}d((n=n.apply(e,o||[])).next())}))};let t,n,i;console.log("Content script running"),chrome.runtime.onMessage.addListener(((l,s,c)=>{console.log("Message received in content script:",l),console.log("From sender:",s),"CHOOSE_VIDEO_SOURCE"===l.type?(console.log("Choosing video source..."),new Promise((o=>{console.log("Choosing video source...");const t=document.querySelectorAll("video");if(0===t.length)return console.log("No video elements found on this page."),void o(null);console.log(`Found ${t.length} video element(s):`),t.forEach(((n,i)=>{console.log(`Video ${i+1}:`,n);const l=document.createElement("div");l.classList.add("video-overlay");const s=n.getBoundingClientRect();l.style.left=`${s.left+window.scrollX}px`,l.style.top=`${s.top+window.scrollY}px`,l.style.width=`${s.width}px`,l.style.height=`${s.height}px`,document.body.appendChild(l),n.addEventListener("mouseenter",(()=>{console.log("Mouse entered video"),l.style.backgroundColor="rgba(8, 166, 246, 0.45)"})),n.addEventListener("mouseleave",(()=>{console.log("Mouse left video"),l.style.backgroundColor="rgba(8, 166, 246, 0.65)"})),n.addEventListener("click",(()=>{console.log("Video clicked:",n),o(n),l.remove(),e=n,t.forEach((e=>{e.replaceWith(e.cloneNode(!0))}))}),{once:!0})}))})).then((e=>{e?(console.log("Video source chosen:",e),function(e){o(this,void 0,void 0,(function*(){t=e,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="-1",t.muted=!0,t.autoplay=!0,t.playsInline=!0,yield t.play(),document.body.appendChild(t);const{videoWidth:l,videoHeight:s}=t;n=document.createElement("canvas"),n.width=l,n.height=s,n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.zIndex="1000",n.style.pointerEvents="none",document.body.appendChild(n);const c=n.transferControlToOffscreen(),d=chrome.runtime.getURL("workerThread.js"),r=chrome.runtime.getURL("wasm/opencv.js"),a=URL.createObjectURL(new Blob([`\n        import "${r}";\n        import "${d}";\n        `],{type:"application/javascript"}));i=new Worker(a,{type:"module"}),i.postMessage({type:"INIT",canvas:c,videoWidth:l,videoHeight:s},[c]),function(e,t,n){const l=document.createElement("canvas");l.width=t,l.height=n;const s=l.getContext("2d"),c=()=>o(this,void 0,void 0,(function*(){if(e.readyState<2||0===e.videoWidth||0===e.videoHeight)requestAnimationFrame(c);else{null==s||s.drawImage(e,0,0,t,n);try{const e=yield createImageBitmap(l);i.postMessage({type:"FRAME",imageBitMap:e,videoWidth:t,videoHeight:n},[e])}catch(e){console.error("Error creating ImageBitmap:",e)}requestAnimationFrame(c)}}));c()}(t,l,s)}))}(e),chrome.runtime.sendMessage({type:"VIDEO_SOURCE_CHOSEN"})):console.log("No video source selected.")}))):"START_TRACKING"===l.type?(console.log("Starting puck tracking..."),console.log("Tracking puck...")):"STOP_TRACKING"===l.type&&console.log("Stopping puck tracking...")}))}();