!function(){"use strict";let e=null;var o=function(e,o,t,n){return new(t||(t=Promise))((function(i,l){function s(e){try{d(n.next(e))}catch(e){l(e)}}function c(e){try{d(n.throw(e))}catch(e){l(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,c)}d((n=n.apply(e,o||[])).next())}))};let t,n;console.log("Content script running"),chrome.runtime.onMessage.addListener(((i,l,s)=>{console.log("Message received in content script:",i),console.log("From sender:",l),"CHOOSE_VIDEO_SOURCE"===i.type?(console.log("Choosing video source..."),new Promise((o=>{console.log("Choosing video source...");const t=document.querySelectorAll("video");if(0===t.length)return console.log("No video elements found on this page."),void o(null);console.log(`Found ${t.length} video element(s):`),t.forEach(((n,i)=>{console.log(`Video ${i+1}:`,n);const l=document.createElement("div");l.classList.add("video-overlay");const s=n.getBoundingClientRect();l.style.left=`${s.left+window.scrollX}px`,l.style.top=`${s.top+window.scrollY}px`,l.style.width=`${s.width}px`,l.style.height=`${s.height}px`,document.body.appendChild(l),n.addEventListener("mouseenter",(()=>{console.log("Mouse entered video"),l.style.backgroundColor="rgba(8, 166, 246, 0.45)"})),n.addEventListener("mouseleave",(()=>{console.log("Mouse left video"),l.style.backgroundColor="rgba(8, 166, 246, 0.65)"})),n.addEventListener("click",(()=>{console.log("Video clicked:",n),o(n),l.remove(),e=n,t.forEach((e=>{e.replaceWith(e.cloneNode(!0))}))}),{once:!0})}))})).then((e=>{e?(console.log("Video source chosen:",e),function(e){o(this,void 0,void 0,(function*(){t=e,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="-1",t.muted=!0,t.autoplay=!0,t.playsInline=!0,yield t.play(),document.body.appendChild(t);const{videoWidth:i,videoHeight:l}=t,s=document.createElement("canvas");s.width=i,s.height=l,s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.zIndex="1000",s.style.pointerEvents="none",document.body.appendChild(s);const c=s.transferControlToOffscreen();n=new Worker(chrome.runtime.getURL("workerThread.js"),{type:"module"}),n.postMessage({type:"INIT",canvas:c,videoWidth:i,videoHeight:l},[c]),function(e,t,i){const l=document.createElement("canvas");l.width=t,l.height=i;const s=l.getContext("2d"),c=()=>o(this,void 0,void 0,(function*(){null==s||s.drawImage(e,0,0,t,i);const o=yield createImageBitmap(l);n.postMessage({type:"FRAME",imageBitMap:o,videoWidth:t,videoHeight:i},[o]),requestAnimationFrame(c)}));c()}(t,i,l)}))}(e),chrome.runtime.sendMessage({type:"VIDEO_SOURCE_CHOSEN"})):console.log("No video source selected.")}))):"START_TRACKING"===i.type?(console.log("Starting puck tracking..."),console.log("Tracking puck...")):"STOP_TRACKING"===i.type&&console.log("Stopping puck tracking...")}))}();